---
title: '(WIP) Tidy Tuesday: Water Sources'
author: "Matthew Henderson"
date: '2021-05-04'
slug: un-votes
categories: posts
tags: tidy-tuesday
draft: yes
editor_options:
  chunk_output_type: console
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  comment = "#>",
  collapse = TRUE,
  fig.path = "figure/",
  cache.path = "cache/"
)

ggplot2::theme_set(ggplot2::theme_light())
```

```{r, cache=TRUE}
library(tidytuesdayR)

tuesdata <- tt_load(2021, week = 19)
```

```{r}
library(tidyverse)

water <- tuesdata$water %>%
  rename(
    lat = lat_deg,
    lon = lon_deg,
    country = country_name
  )
```

```{r}
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)

ethiopia <- ne_countries(country = "ethiopia", scale = "medium", returnclass = "sf")

ethiopia_bbox <- st_bbox(ethiopia)

ethiopia_water <- water %>%
  filter(country == "Ethiopia") %>%
  filter(lat >= ethiopia_bbox$ymin) %>%
  filter(lat <= ethiopia_bbox$ymax) %>%
  filter(lon >= ethiopia_bbox$xmin) %>%
  filter(lon <= ethiopia_bbox$xmax)
```

```{r}
library(ggmap)

ethiopia_map <- get_stamenmap(bbox = c(
  left = ethiopia_bbox[["xmin"]],
  right = ethiopia_bbox[["xmax"]],
  bottom = ethiopia_bbox[["ymin"]],
  top = ethiopia_bbox[["ymax"]]
), zoom = 7, maptype = "terrain")
```

```{r}
ethiopia_water <- ethiopia_water %>%
  filter(!is.na(water_source))
```

```{r}
ggmap(ethiopia_map) +
  geom_point(aes(x = lon, y = lat), data = ethiopia_water, size = .2, alpha = .2) +
  labs(
    title = "Locations of water sources in Ethiopia",
    colour = "Water source"
  ) +
  facet_wrap(~water_source) +
  theme(
    panel.background  = element_rect(fill = "#060405"),
    plot.background   = element_rect(fill = "#060405"),
    legend.background = element_rect(fill = "#060405"),
    plot.title        = element_text(colour = "#fba55a", size = 10, face = "bold", hjust = 0.5, family = "Elephant"),
    plot.subtitle     = element_text(colour = "#fba55a", size = 10, face = "bold", hjust = 0.5, family = "Elephant"),
    plot.caption      = element_text(colour = "#fba55a", size = 10, face = "bold", hjust = 0.5, family = "Elephant"),
    legend.title      = element_text(colour = "#d0605e", size = 10, face = "bold", hjust = 0.5, family = "Elephant"),
    legend.position   = "none",
    #plot.margin       = unit(c(0.3, 0.3, 0.3, 0.3), "cm"), #top, right, bottom, left
    legend.key        = element_rect(colour = "#060405", fill = "#060405"),
    legend.spacing.x  = unit(0.5,"cm"),
    legend.text       = element_text(colour="#fba55a", size = 7, family = "Elephant"),
    axis.title.x      = element_blank(),
    axis.title.y      = element_blank(),
    axis.text.x       = element_blank(),
    axis.text.y       = element_blank(),
    axis.ticks.x      = element_blank(),
    axis.ticks.y      = element_blank(),
    panel.grid.major  = element_blank(),
    panel.grid.minor  = element_blank()
  )

ggsave(filename = paste0("plots/plot_", as.numeric(Sys.time()), ".png"))
```


```{r, eval=FALSE}
library(magick)
library(tictoc)

tic()
imgs <- image_read(list.files("plots", full.names = TRUE))

animation <- image_animate(image_scale(imgs, "300x300"), fps = 4, dispose = "previous")

image_write(animation, "plot.gif")
toc()
```
